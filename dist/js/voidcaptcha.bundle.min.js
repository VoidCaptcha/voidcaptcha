/*! @voidcaptcha/core | @version 0.1.0 | @license MIT | @copyright rat.md <info@rat.md> */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).VoidCaptcha=t()}(this,(function(){"use strict";function e(e,t,n,a){return new(n||(n=Promise))((function(i,r){function o(e){try{d(a.next(e))}catch(e){r(e)}}function s(e){try{d(a.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}d((a=a.apply(e,t||[])).next())}))}const t=function(t){return t.botScore,t.requiredBotScore,new class t{static ready(){let e=new CustomEvent("VoidCaptcha::loaded");"loading"===document.readyState?document.addEventListener("DOMContentLoaded",window.dispatchEvent.bind(null,e)):setTimeout(window.dispatchEvent.bind(null,e),10)}static get config(){return{providers:[],botScore:20,requiredBotScore:5,url:null}}constructor(e){let n;if(e.providers instanceof Array&&(n=[...e.providers].filter((e=>!e.passive))),0===n.length)throw new Error("VoidCaptcha requires at least one active provider.");this.config=Object.assign({},t.config,e),this.active=n}create(e){if("string"==typeof e&&(e=document.querySelectorAll(e)),e instanceof HTMLElement&&(e=[e]),!("length"in e)||0===e.length)throw new Error("The passed selector does not match or contain any valid element.");[...e].map((e=>{e.classList.add("void-captcha"),e.classList.add("pending"),e.append(...this.renderHidden(e)),e.append(...this.renderField(e)),e.append(...this.renderPopover(e)),e.addEventListener("click",this.open.bind(this,e))}))}renderHidden(e){let t=document.createElement("INPUT");t.type="hidden",t.name=(e.dataset.name||"void")+"[session]",t.value=e.dataset.voidCaptcha;let n=document.createElement("INPUT");return n.type="hidden",n.name=(e.dataset.name||"void")+"[checksum]",n.value="",[t,n]}renderField(e){let t=document.createElement("DIV");return t.className="void-captcha-field",t.innerHTML='\n                <label><span class="status-pending"></span> Click to Verify</label>\n                <a href="https://voidcapture.com" target="_blank">Powered by VoidCapture</a>\n            ',[t]}renderPopover(e){let t=document.createElement("DIV");return t.className="void-captcha-popover",t.innerHTML='<canvas width="200" height="200" class="void-captcha-puzzle"></canvas>',[t]}open(t,n){return e(this,void 0,void 0,(function*(){if(t.classList.contains("loading")||t.classList.contains("open"))return;t.classList.add("loading");let n=t.querySelector("CANVAS"),a={},i=new FormData;i.set("void[data][width]","200"),i.set("void[data][height]","200");for(let e of this.config.providers)a[e.name]=e,i.set("void[providers][]",e.name);i.set("void[session]",t.dataset.voidCaptcha);let r=yield fetch(this.config.url,{method:"POST",body:i}).then((e=>e.json()));a[r.provider].draw(n,r.response,(function(){return e(this,void 0,void 0,(function*(){return i.delete("void[providers][]"),i.set("void[providers][]",r.provider),yield fetch(this.config.url,{method:"POST",body:i}).then((e=>e.json()))}))}),(function(e){t.querySelector('input[type="hidden"][name$="[checksum]"]').value=e})),t.classList.remove("loading"),t.classList.add("waiting"),t.classList.add("open")}))}close(){}verify(){}validate(){}}(t)};return t.Providers={VoidCaptcha_DetectProvider:class{get name(){return"detect"}get passive(){return!0}init(){}},VoidCaptcha_PowProvider:class{get name(){return"pow"}get passive(){return!0}init(){}},VoidCaptcha_PuzzleProvider:class{constructor(){this.placeholder="Slide until the piece fits"}get name(){return"puzzle"}get passive(){return!1}init(){}draw(e,t,n,a){this.canvas=e,this.ctx=e.getContext("2d"),this.ctx.save();const i=new Image;i.onload=()=>{this.ctx.drawImage(i,0,0)},i.src=t.source;const r=new Image;r.onload=e=>{this.ctx.drawImage(r,0,30)},r.src=t.piece;let o=e.parentElement.previousElementSibling.querySelector("label");o.contentEditable="true",o.innerText="",o.dataset.placeholder=this.placeholder;let s=document.createElement("INPUT");s.type="range",s.value="0",s.min="0",s.max="100",s.addEventListener("input",(t=>{this.ctx.clearRect(0,0,e.width,e.height),this.ctx.drawImage(i,0,0),this.ctx.drawImage(r,(e.width-r.width)/100*parseInt(s.value),30),a(((e.width-r.width)/100*parseInt(s.value)).toString())})),e.parentElement.appendChild(s)}},VoidCaptcha_SimilarImageProvider:class{constructor(){this.placeholder="Select  all similar images"}get name(){return"similar-image"}get passive(){return!1}init(){}draw(e,t){let n=e.parentElement.previousElementSibling.querySelector("label");n.innerText="",n.dataset.placeholder=this.placeholder}},VoidCaptcha_SlidePuzzleProvider:class{constructor(){this.placeholder="Slide until the piece fits"}get name(){return"slide-puzzle"}get passive(){return!1}init(){}draw(e,t,n,a){this.canvas=e,this.ctx=e.getContext("2d"),this.ctx.save();const i=new Image;i.onload=()=>{this.ctx.drawImage(i,0,0)},i.src=t.source;const r=new Image;r.onload=e=>{this.ctx.drawImage(r,0,30)},r.src=t.piece;let o=e.parentElement.previousElementSibling.querySelector("label");o.contentEditable="true",o.innerText="",o.dataset.placeholder=this.placeholder;let s=document.createElement("INPUT");s.type="range",s.value="0",s.min="0",s.max="100",s.addEventListener("input",(t=>{this.ctx.clearRect(0,0,e.width,e.height),this.ctx.drawImage(i,0,0),this.ctx.drawImage(r,(e.width-r.width)/100*parseInt(s.value),30),a(((e.width-r.width)/100*parseInt(s.value)).toString())})),e.parentElement.appendChild(s)}},VoidCaptcha_TextProvider:class{constructor(){this.placeholder="Enter CAPTCHA Code here"}get name(){return"text"}get passive(){return!1}init(){}draw(e,t,n,a){this.canvas=e,this.ctx=e.getContext("2d");const i=new Image;i.onload=()=>{this.ctx.drawImage(i,0,0)},i.src="string"==typeof t?t:"";let r=e.parentElement.previousElementSibling.querySelector("label");r.contentEditable="true",r.innerText="",r.dataset.placeholder=this.placeholder,r.focus(),r.addEventListener("keyup",(e=>{let t=r.innerText.trim();t.length>0?r.dataset.placeholder="":r.dataset.placeholder=this.placeholder,a(t)}))}}},t}));//# sourceMappingURL=voidcaptcha.bundle.min.js.map
