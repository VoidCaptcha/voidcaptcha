/*! @voidcaptcha/core | @version 0.1.0 | @license MIT | @copyright rat.md <info@rat.md> */
function e(e,t,i,a){return new(i||(i=Promise))((function(n,s){function r(e){try{c(a.next(e))}catch(e){s(e)}}function o(e){try{c(a.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,o)}c((a=a.apply(e,t||[])).next())}))}const t=function(t){const i={current:t.botScore||20,required:t.botScoreRequired||5,increase(e){this.current+=e},decrease(e){this.current-=e},valid(){return this.current<=this.required}};return new class t{static get config(){return{botScore:20,botScoreRequired:5,callbackHeaders:null,callbackUrl:null,callToValidate:!1,providers:null,statusError:"An error occurred, please try again",statusInvalid:"Verification failed, please try again",statusLoading:"Evaluating, please wait...",statusPuzzle:"Please solve the puzzle below",statusValid:"You're human",statusVerify:"Click to verify you're human"}}constructor(e){let i;if(e.providers instanceof Array&&(i=[...e.providers].filter((e=>!e.passive))),0===i.length)throw new Error("VoidCaptcha requires at least one active provider.");this.config=Object.assign({},t.config,e),this.events={},this.active=i,this.passive=[...e.providers].filter((e=>e.passive))}curl(t,i){return e(this,void 0,void 0,(function*(){let e=new FormData;e.set("void[data][width]","250"),e.set("void[data][height]","300");for(let t of this.config.providers)e.set("void[providers][]",t.name);e.set("void[session]",i.dataset.voidCaptcha);let t=new Headers;if(t.append("DNT","1"),t.append("X-Requested-With","XMLHttpRequest"),t.append("Via","VoidCaptcha"),this.config.callbackHeaders&&"object"==typeof this.config.callbackHeaders)for(const[e,i]of Object.entries(this.config.callbackHeaders))t.append(e,i);let a=yield fetch(this.config.callbackUrl,{method:"POST",body:e,headers:t}),n=null;try{n=yield a.json()}catch(e){return this.trigger("error",i),!1}return n}))}assign(e){if("string"==typeof e&&(e=document.querySelectorAll(e)),e instanceof HTMLElement&&(e=[e]),!("length"in e)||0===e.length)throw new Error("The passed selector does not match or contain any valid HTML element.");[...e].map(this.init.bind(this))}init(e){e.classList.add("void-captcha"),e.dataset.voidCaptchaState="loading";let t=document.createElement("INPUT");t.type="hidden",t.name=(e.dataset.name||"void")+"[session]",t.value=e.dataset.voidCaptcha,e.appendChild(t);let i=document.createElement("INPUT");i.type="hidden",i.name=(e.dataset.name||"void")+"[checksum]",i.value="",e.appendChild(i);let a=document.createElement("DIV");a.className="void-captcha-field",a.innerHTML=`\n                <label>${this.config.statusVerify}</label>\n                <a href="https://voidcaptcha.com" target="_blank">Powered by VoidCaptcha</a>\n            `,e.appendChild(a);for(const e of this.passive)e.init();for(const e of this.active)e.init();return e.addEventListener("click",this.onClick.bind(this,e)),this.trigger("init",e),e}onClick(t,a){return e(this,void 0,void 0,(function*(){if("completed"!==t.dataset.voidCaptchaState&&"success"!==t.dataset.voidCaptchaState&&("error"===t.dataset.voidCaptchaState&&(t.dataset.voidCaptchaState="loading"),"loading"===t.dataset.voidCaptchaState)){t.dataset.voidCaptchaState="pending",t.querySelector("label").innerText=this.config.statusLoading;let a=yield this.curl("request",t);if(!1===a)return t.dataset.voidCaptchaState="error",void(t.querySelector("label").innerText=this.config.statusError);setTimeout((()=>e(this,void 0,void 0,(function*(){if(this.passive.length>0){let e=Object.assign({},i);for(const t of this.passive)e=yield t.process(e);if(e.valid())return t.dataset.voidCaptchaState="success",void(t.querySelector("label").innerText=this.config.statusValid)}console.log(a),this.active[a.provider]}))),10)}}))}request(e){}opens(e){"pending"===e.dataset.voidCaptchaState&&this.render(e),e.dataset.voidCaptchaState="open"}render(e){e.dataset.voidCaptchaState="loading"}closes(e){e.dataset.voidCaptchaState="open"}renderPopover(e){let t=document.createElement("DIV");return t.className="void-captcha-popover",t.innerHTML='\n                <canvas width="250" height="300" class="void-captcha-puzzle"></canvas>\n                \n                <div class="void-captcha-actions">\n                    <button type="button" data-void="reload">\n                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-clockwise" viewBox="0 0 16 16">\n                            <path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/>\n                            <path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"/>\n                        </svg>\n                        <span>Reload</span>\n                    </button>\n                    <button type="button" data-void="close">\n                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-lg" viewBox="0 0 16 16">\n                            <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"/>\n                        </svg>\n                        <span>Close</span>\n                    </button>\n                </div>\n            ',[t]}open(t,i){return e(this,void 0,void 0,(function*(){if(t.classList.contains("loading")||t.classList.contains("open"))return;t.classList.add("loading");let i=t.querySelector("CANVAS"),a={},n=new FormData;n.set("void[data][width]","250"),n.set("void[data][height]","300");for(let e of this.config.providers)a[e.name]=e,n.set("void[providers][]",e.name);n.set("void[session]",t.dataset.voidCaptcha);let s=yield fetch(this.config.callbackUrl,{method:"POST",body:n}).then((e=>e.json()));const r=function(e){t.querySelector('input[type="hidden"][name$="[checksum]"]').value=e},o=()=>e(this,void 0,void 0,(function*(){s=yield fetch(this.config.callbackUrl,{method:"POST",body:n}).then((e=>e.json())),a[s.provider].draw(i,s.response,o,r)}));a[s.provider].draw(i,s.response,o,r),t.querySelector('button[data-void="reload"]').addEventListener("click",o),t.querySelector('button[data-void="close"]').addEventListener("click",close),t.classList.remove("loading"),t.classList.add("waiting"),t.classList.add("open")}))}close(){}verify(){}validate(){}trigger(e,t){if(e in this.events)for(const i of this.events[e])i.call(window,this,t)}on(e,t){e in this.events||(this.events[e]=[]),this.events[e].push(t)}off(e,t){let i;e in this.events&&(i=this.events[e].indexOf(t))>=0&&this.events[e].splice(i,1)}}(t)};class i{get name(){return"detect"}get passive(){return!0}get userAgentRegex(){return{high:["always(.*)online","archiver","browsershot","crawler","diagnostic","(down|up)time","indexer","monitoring","scanner","sp(i|y)der","aboundex","addthis","alexa","ahref","arachni","archive.org","butterfly","cloudflare","coccoc","curios","domain(.+)","duckduck","ezoom","let'?s(.*)encrypt","httpmon","outbrain","pinterest","postm(a|e)n","quora","yandex"].join("|"),normal:["archive","ask(.+)","audit","backlink","batch","(.+)bot","checker","collect","diagnose","extractor","fetch","generator","grab","headless","http","hunter","lookup","index","insight","inspector","monitor","optimize","probe","provider","proxy","review","riddle","scan","schedule","scrap","screenshot","search","seeker","service","share","sucker","synthetics","testing","transcoder","validator","veri(f|t)y","amazon","apache","facebook","feedburner","feedly","feedpin","gmail","hubspot","kaspersky","linked","mastodon","php","python","reddit","shopify","torrent","twitter","W3C_","wordpress"].join("|"),low:[".com","agent","blog","bin","bot","cache","data","e?mail","engine","explorer","favicon","feed","filter","guide","improve","modified","online","parse","preview","reader","rss","seo","server","shop","site","sql","scrap","ssl","stats?(istic)?","wiki","google"].join("|")}}constructor(){this.rules={userAgent:{malicious:50,suspicious:25,strange:10,empty:10,valid:-5}}}init(){this.detectUserAgent(),this.detectBrowserAndDevice(),this.startUserObserver()}detectUserAgent(){return navigator.userAgent.trim().length,1}detectBrowserAndDevice(){return/headless/.test(navigator.userAgent),800===(window.screen.width||0)&&600===(window.screen.height||0)&&0===window.screen.orientation.type.indexOf("portrait")&&800==window.outerWidth&&window.outerHeight,(navigator.plugins||[]).length,1}startUserObserver(){}process(e){return new Promise(((t,i)=>{t(e)}))}}class a{get name(){return"proof-of-work"}get passive(){return!0}constructor(e=4,t=2e4){this.block=null,this.difficulty=e,this.timeout=t}init(e){this.block="data",this.difficulty=4,this.timeout=2e4}process(e){return new Promise(((t,i)=>{let a=URL.createObjectURL(new Blob(["(",this.webWorker(),")()"],{type:"application/javascript"})),n=new Worker(a);n.onmessage=i=>{let a=i.data.hash,s=i.data.difficulty,r=a.substr(0,s)===Array(s+1).join("0"),o=parseInt(a.substr(-1));r&&!isNaN(o)&&e.decrease(20),n.terminate(),t(e)},n.onerror=i=>{n.terminate(),t(e)},n.postMessage({block:this.block,difficulty:this.difficulty,timeout:this.timeout}),URL.revokeObjectURL(a)}))}webWorker(){return function(){addEventListener("message",(e=>{let t,i=e.data.block,a=e.data.difficulty,n=e.data.timeout,s=0,r=new TextEncoder,o=!1,c=Date.now();function d(e){t=Array.from(new Uint8Array(e)).map((e=>e.toString(16).padStart(2,"0"))).join("");let i=t.substr(0,a)===Array(a+1).join("0"),n=parseInt(t.substr(-1));i&&!isNaN(n)?l():h()}function l(){postMessage({data:e.data,block:i,difficulty:a,hash:t,time:Date.now()-c})}function h(){if(o)return l();let e=r.encode(t+s++);crypto.subtle.digest("SHA-512",e.buffer).then(d,l)}setTimeout((()=>{o=!0}),n),h()}))}.toString()}}class n{constructor(){this.placeholder="Slide until the piece fits"}get name(){return"puzzle"}get passive(){return!1}init(){}draw(e,t,i,a){this.canvas=e,this.ctx=e.getContext("2d"),this.ctx.save();const n=new Image;n.onload=()=>{this.ctx.drawImage(n,0,0)},n.src=t.source;const s=new Image;s.onload=e=>{this.ctx.drawImage(s,0,30)},s.src=t.piece;let r=e.parentElement.previousElementSibling.querySelector("label");r.contentEditable="true",r.innerText="",r.dataset.placeholder=this.placeholder;let o=document.createElement("INPUT");o.type="range",o.value="0",o.min="0",o.max="100",o.addEventListener("input",(t=>{this.ctx.clearRect(0,0,e.width,e.height),this.ctx.drawImage(n,0,0),this.ctx.drawImage(s,(e.width-s.width)/100*parseInt(o.value),30),a(((e.width-s.width)/100*parseInt(o.value)).toString())})),e.parentElement.appendChild(o)}}class s{constructor(){this.placeholder="Select all similar images"}get name(){return"similar-image"}get passive(){return!1}init(){}draw(e,t,i,a){this.canvas=e,this.ctx=e.getContext("2d");const n=new Image;n.onload=()=>{this.ctx.drawImage(n,0,0)},n.src="string"==typeof t?t:"";let s=e.parentElement.previousElementSibling.querySelector("label");s.contentEditable="true",s.innerText="",s.dataset.placeholder=this.placeholder,s.focus(),s.addEventListener("keyup",(e=>{let t=s.innerText.trim();t.length>0?s.dataset.placeholder="":s.dataset.placeholder=this.placeholder,a(t)}))}}class r{constructor(){this.placeholder="Slide until the piece fits"}get name(){return"slide-puzzle"}get passive(){return!1}init(){}draw(e,t,i,a){this.canvas=e,this.ctx=e.getContext("2d"),this.ctx.save();const n=new Image;n.onload=()=>{this.ctx.drawImage(n,0,0)},n.src=t.source;const s=new Image;s.onload=e=>{this.ctx.drawImage(s,0,30)},s.src=t.piece;let r=e.parentElement.previousElementSibling.querySelector("label");r.contentEditable="true",r.innerText="",r.dataset.placeholder=this.placeholder;let o=document.createElement("INPUT");o.type="range",o.value="0",o.min="0",o.max="100",o.addEventListener("input",(t=>{this.ctx.clearRect(0,0,e.width,e.height),this.ctx.drawImage(n,0,0),this.ctx.drawImage(s,(e.width-s.width)/100*parseInt(o.value),30),a(((e.width-s.width)/100*parseInt(o.value)).toString())})),e.parentElement.appendChild(o)}}class o{constructor(){this.placeholder="Enter CAPTCHA Code here"}get name(){return"text"}get passive(){return!1}init(){}draw(e,t,i,a){void 0!==this.ctx?this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height):(this.canvas=e,this.ctx=e.getContext("2d"));const n=new Image;n.onload=()=>{this.ctx.drawImage(n,0,0)},n.src="string"==typeof t?t:"";let s=e.parentElement.previousElementSibling.querySelector("label");s.contentEditable="true",s.innerText="",s.dataset.placeholder=this.placeholder,s.focus(),s.addEventListener("keyup",(e=>{let t=s.innerText.trim();a(t)}))}}export{t as VoidCaptcha,i as VoidCaptcha_DetectProvider,a as VoidCaptcha_ProofOfWorkProvider,n as VoidCaptcha_PuzzleProvider,s as VoidCaptcha_SimilarImageProvider,r as VoidCaptcha_SlidePuzzleProvider,o as VoidCaptcha_TextProvider};//# sourceMappingURL=voidcaptcha.bundle.min.js.map
